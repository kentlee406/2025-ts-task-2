import{a as j,d as T,r as _,w as B,u as R,o as E,b as P,e as m,f as v,g as e,t as f,i as $,v as C,h as U,j as A,q as D,m as F,F as M,n as L,p as w}from"./index-B9q6o_mF.js";import{M as N,_ as z}from"./DeleteModal.vue_vue_type_script_setup_true_lang-CyHCth-x.js";const q="https://ec-course-api.hexschool.io",x="kentlee406",g=j.create({baseURL:q});g.interceptors.request.use(n=>{const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return i&&(n.headers.Authorization=i),n},n=>Promise.reject(n));g.interceptors.response.use(n=>n,n=>Promise.reject(n.response?.data||n));const G=n=>g.get(`/v2/api/${x}/admin/coupons`,{params:n}),H=n=>g.post(`/v2/api/${x}/admin/coupon`,{data:n}),I=n=>{const{id:i,data:r}=n;return g.put(`/v2/api/${x}/admin/coupon/${i}`,{data:r})},W=n=>g.delete(`/v2/api/${x}/admin/coupon/${n}`),V=n=>{const i=new Date(n*1e3),r=b=>b<10?"0"+b:b,l=i.getFullYear(),c=r(i.getMonth()+1),d=r(i.getDate());return`${l}-${c}-${d}`},Y={class:"modal-dialog modal-dialog-centered modal-lg"},J={class:"modal-content rounded-lg"},K={class:"modal-header"},O={class:"modal-title",id:"couponModalLabel"},Q={class:"modal-body"},X={class:"mb-3"},Z={class:"mb-3"},ee={class:"mb-3"},te={class:"mb-3"},oe=["value"],le={class:"mb-3 d-flex align-items-center"},ne={class:"form-check form-switch"},se={class:"modal-footer"},ae=["disabled"],de=T({__name:"CouponModal",props:{coupon:{},isLoading:{type:Boolean}},setup(n,{expose:i}){const r={id:"",title:"",is_enabled:0,percent:0,due_date:Date.now()/1e3,code:""},l=_({...r});B(()=>n.coupon,u=>{l.value={...u}});const c=R("modalRef");let d=null,p=null;E(()=>{c.value&&(d=new N(c.value))}),P(()=>{d&&d.dispose()});const b=u=>{d&&(d.show(),p=async t=>{try{await u(t),h()}catch{}})},h=()=>{d&&d.hide()},y=()=>{p&&p(l.value)},k=u=>{const t=u.target;l.value.due_date=new Date(t.value).getTime()/1e3};return i({openModal:b,closeModal:h}),(u,t)=>(v(),m("div",{ref_key:"modalRef",ref:c,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",Y,[e("div",J,[e("div",K,[e("h5",O,f(l.value.id?"編輯優惠券":"新增優惠券"),1),t[4]||(t[4]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Q,[e("form",null,[e("div",X,[t[5]||(t[5]=e("label",{for:"couponTitle",class:"form-label"},"優惠券標題",-1)),$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.title=s),type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"例如：新會員專屬折扣"},null,512),[[C,l.value.title]])]),e("div",Z,[t[6]||(t[6]=e("label",{for:"couponCode",class:"form-label"},"優惠碼",-1)),$(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.code=s),type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"例如：NEW2024"},null,512),[[C,l.value.code]])]),e("div",ee,[t[7]||(t[7]=e("label",{for:"couponDiscount",class:"form-label"},"折扣",-1)),$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.percent=s),type:"number",max:"100",min:"0",class:"form-control rounded-lg",id:"couponDiscount",placeholder:"例如：90 代表 9 折"},null,512),[[C,l.value.percent,void 0,{number:!0}]])]),e("div",te,[t[8]||(t[8]=e("label",{for:"couponEndDate",class:"form-label"},"截止日",-1)),e("input",{value:U(V)(l.value.due_date),onChange:k,type:"date",class:"form-control rounded-lg",id:"couponEndDate"},null,40,oe)]),e("div",le,[t[9]||(t[9]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",ne,[$(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.is_enabled=s),class:"form-check-input",type:"checkbox",id:"flexSwitchCouponEnable","true-value":1,"false-value":0},null,512),[[A,l.value.is_enabled]])])])])]),e("div",se,[t[10]||(t[10]=e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{onClick:y,disabled:u.isLoading,type:"button",class:"btn btn-dark rounded-lg"}," 儲存 ",8,ae)])])])],512))}}),ie={class:"d-flex justify-content-end align-items-center pe-3 mb-4"},re={key:0,class:"text-center"},ce={key:1,class:"card shadow-sm rounded-lg flex-grow-1"},ue={class:"card-body p-4"},pe={class:"table-responsive"},be={class:"table table-hover align-middle"},me={class:"text-center"},ve={class:"form-check form-switch d-flex justify-content-center align-items-center"},_e=["checked"],fe={class:"text-nowrap"},ge=["onClick"],he=["onClick"],ye={class:"d-flex justify-content-center mt-4"},ke={class:"pagination"},$e={class:"page-item"},xe=["disabled"],Ce=["onClick","disabled"],Me={class:"page-item"},we=["disabled"],De=T({__name:"CouponManagement",setup(n){const i={id:"",title:"",is_enabled:0,percent:0,due_date:Date.now()/1e3,code:""},r=_(i),l=_("1"),c=_([]),d=_({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),p=async()=>{try{const s=await G({page:l.value});c.value=s.data.coupons,d.value=s.data.pagination}catch{alert("取得優惠券列表失敗")}};E(()=>{p()});const b=R("couponModalRef"),h=R("deleteModalRef"),y=_(!1),k=s=>{s?r.value={...s}:r.value={...i},b.value?.openModal(async o=>{y.value=!0;try{s?await I({id:o.id,data:{title:o.title,is_enabled:Number(o.is_enabled),percent:o.percent,due_date:o.due_date,code:o.code}}):await H({title:o.title,is_enabled:Number(o.is_enabled),percent:o.percent,due_date:o.due_date,code:o.code})}catch{alert("新增/編輯優惠券失敗")}finally{y.value=!1,p()}})},u=s=>{h.value?.openModal(()=>t(s))},t=async s=>{try{await W(s)}catch{alert("刪除優惠券失敗")}finally{p()}};return(s,o)=>(v(),m(M,null,[e("div",ie,[e("button",{onClick:o[0]||(o[0]=a=>k()),class:"btn btn-dark rounded-lg px-4 py-2",type:"button"},[...o[3]||(o[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),F("新增優惠券 ",-1)])])]),c.value.length?(v(),m("div",ce,[e("div",ue,[e("div",pe,[e("table",be,[o[4]||(o[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"截止日"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(v(!0),m(M,null,L(c.value,a=>(v(),m("tr",{key:a.due_date},[e("td",null,f(a.title),1),e("td",null,f(a.code),1),e("td",null,f(a.percent)+" %",1),e("td",null,f(U(V)(a.due_date)),1),e("td",me,[e("div",ve,[e("input",{style:{"pointer-events":"none"},class:"form-check-input",type:"checkbox",readonly:"",checked:!!a.is_enabled},null,8,_e)])]),e("td",fe,[e("button",{onClick:S=>k(a),class:"btn btn-sm btn-outline-dark rounded-lg me-2",type:"button"}," 編輯 ",8,ge),e("button",{onClick:S=>u(a.id),class:"btn btn-sm btn-outline-danger rounded-lg",type:"button"}," 刪除 ",8,he)])]))),128))])])]),e("nav",ye,[e("ul",ke,[e("li",$e,[e("button",{onClick:o[1]||(o[1]=a=>l.value=String(Number(l.value)-1)),disabled:!d.value?.has_pre,type:"button",class:w(["page-link",{disabled:!d.value?.has_pre}]),"aria-label":"Previous"},[...o[5]||(o[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,xe)]),(v(!0),m(M,null,L(d.value?.total_pages,a=>(v(),m("li",{class:"page-item",key:a},[e("button",{onClick:S=>l.value=a.toString(),disabled:l.value===a.toString(),type:"button",class:w(["page-link",{active:l.value===a.toString()}])},f(a),11,Ce)]))),128)),e("li",Me,[e("button",{onClick:o[2]||(o[2]=a=>l.value=String(Number(l.value)+1)),disabled:d.value?.has_next,class:w(["page-link",{disabled:d.value?.has_next}]),type:"button","aria-label":"Next"},[...o[6]||(o[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,we)])])])])])):(v(),m("p",re,"目前還沒有優惠券")),D(de,{ref_key:"couponModalRef",ref:b,coupon:r.value,"is-loading":y.value},null,8,["coupon","is-loading"]),D(z,{ref_key:"deleteModalRef",ref:h,title:"刪除訂單",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{De as default};
