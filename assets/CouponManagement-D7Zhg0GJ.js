import{a as P,d as j,r as b,o as A,u as M,e as r,f as c,g as e,q as w,m as B,F as g,n as R,p as y,s as F,t as v,h as L}from"./index-DU9cs_qp.js";import{_ as N}from"./DeleteModal.vue_vue_type_script_setup_true_lang-B2iUQTwA.js";const T="https://ec-course-api.hexschool.io",m="kentlee406",p=P.create({baseURL:T});p.interceptors.request.use(n=>{const a=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return a&&(n.headers.Authorization=a),n},n=>Promise.reject(n));p.interceptors.response.use(n=>n,n=>Promise.reject(n.response?.data||n));const E=n=>p.get(`/v2/api/${m}/admin/coupons`,{params:n}),V=n=>p.post(`/v2/api/${m}/admin/coupon`,{data:n}),z=n=>{const{id:a,data:i}=n;return p.put(`/v2/api/${m}/admin/coupon/${a}`,{data:i})},U=n=>p.delete(`/v2/api/${m}/admin/coupon/${n}`),q=n=>{const a=new Date(n*1e3),i=u=>u<10?"0"+u:u,l=a.getFullYear(),_=i(a.getMonth()+1),d=i(a.getDate());return`${l}-${_}-${d}`},G={class:"d-flex justify-content-end align-items-center pe-3 mb-4"},H={key:0,class:"text-center"},I={key:1,class:"card shadow-sm rounded-lg flex-grow-1"},Y={class:"card-body p-4"},J={class:"table-responsive"},K={class:"table table-hover align-middle"},O={class:"text-center"},Q={class:"form-check form-switch d-flex justify-content-center align-items-center"},W=["checked"],X={class:"text-nowrap"},Z=["onClick"],ee=["onClick"],te={class:"d-flex justify-content-center mt-4"},ne={class:"pagination"},se={class:"page-item"},oe=["disabled"],ae=["onClick","disabled"],le={class:"page-item"},ie=["disabled"],ce=j({__name:"CouponManagement",setup(n){const a={id:"",title:"",is_enabled:0,percent:0,due_date:Date.now()/1e3,code:""},i=b(a),l=b("1"),_=b([]),d=b({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),f=async()=>{try{const o=await E({page:l.value});_.value=o.data.coupons,d.value=o.data.pagination}catch{alert("取得優惠券列表失敗")}};A(()=>{f()});const u=M("couponModalRef"),k=M("deleteModalRef"),h=b(!1),x=o=>{o?i.value={...o}:i.value=a,u.value?.openModal(async t=>{h.value=!0;try{o?await z({id:t.id,data:{...t,is_enabled:Number(t.is_enabled)}}):await V({...t,is_enabled:Number(t.is_enabled)})}catch{alert("新增/編輯優惠券失敗")}finally{h.value=!1,f()}})},S=o=>{k.value?.openModal(()=>D(o))},D=async o=>{try{await U(o)}catch{alert("刪除優惠券失敗")}finally{f()}};return(o,t)=>{const $=F("CouponModal");return c(),r(g,null,[e("div",G,[e("button",{onClick:t[0]||(t[0]=s=>x()),class:"btn btn-dark rounded-lg px-4 py-2",type:"button"},[...t[3]||(t[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),B("新增優惠券 ",-1)])])]),_.value.length?(c(),r("div",I,[e("div",Y,[e("div",J,[e("table",K,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"截止日"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(c(!0),r(g,null,R(_.value,s=>(c(),r("tr",{key:s.due_date},[e("td",null,v(s.title),1),e("td",null,v(s.code),1),e("td",null,v(s.percent)+" %",1),e("td",null,v(L(q)(s.due_date)),1),e("td",O,[e("div",Q,[e("input",{style:{"pointer-events":"none"},class:"form-check-input",type:"checkbox",readonly:"",checked:!!s.is_enabled},null,8,W)])]),e("td",X,[e("button",{onClick:C=>x(s),class:"btn btn-sm btn-outline-dark rounded-lg me-2",type:"button"}," 編輯 ",8,Z),e("button",{onClick:C=>S(s.id),class:"btn btn-sm btn-outline-danger rounded-lg",type:"button"}," 刪除 ",8,ee)])]))),128))])])]),e("nav",te,[e("ul",ne,[e("li",se,[e("button",{onClick:t[1]||(t[1]=s=>l.value=String(Number(l.value)-1)),disabled:!d.value?.has_pre,type:"button",class:y(["page-link",{disabled:!d.value?.has_pre}]),"aria-label":"Previous"},[...t[5]||(t[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,oe)]),(c(!0),r(g,null,R(d.value?.total_pages,s=>(c(),r("li",{class:"page-item",key:s},[e("button",{onClick:C=>l.value=s.toString(),disabled:l.value===s.toString(),type:"button",class:y(["page-link",{active:l.value===s.toString()}])},v(s),11,ae)]))),128)),e("li",le,[e("button",{onClick:t[2]||(t[2]=s=>l.value=String(Number(l.value)+1)),disabled:d.value?.has_next,class:y(["page-link",{disabled:d.value?.has_next}]),type:"button","aria-label":"Next"},[...t[6]||(t[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,ie)])])])])])):(c(),r("p",H,"目前還沒有優惠券")),w($,{ref_key:"couponModalRef",ref:u,coupon:i.value,"is-loading":h.value},null,8,["coupon","is-loading"]),w(N,{ref_key:"deleteModalRef",ref:k,title:"刪除訂單",content:"確定要刪除該優惠券嗎？"},null,512)],64)}}});export{ce as default};
